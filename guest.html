<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheMoneyOlympics - Financial Literacy App</title>
    
    <!-- Device detection (must be before other scripts) -->
    <script src="js/device-detection.js"></script>
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/device-specific.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css">
    <script>
        // Device detection using feature detection approach
        function detectDevice() {
            // Check for touch capabilities
            const hasTouchScreen = !!(('ontouchstart' in window) || 
                                   (navigator.maxTouchPoints > 0) || 
                                   (navigator.msMaxTouchPoints > 0));
            
            // Check for screen size (mobile typically has smaller screens)
            const isSmallScreen = window.innerWidth < 768;
            
            // Check for mobile-specific browser features in user agent
            const hasMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // Check for mobile-specific orientation capability
            const hasOrientationChange = typeof window.orientation !== 'undefined';
            
            // Final determination based on multiple factors
            const isMobileDevice = hasTouchScreen && (isSmallScreen || hasMobileUA || hasOrientationChange);
            
            // Debug logging
            console.log("ðŸ“± DEVICE DETECTION LOG:");
            console.log("- Has touch screen:", hasTouchScreen);
            console.log("- Is small screen:", isSmallScreen, `(${window.innerWidth}px)`);
            console.log("- Has mobile user agent:", hasMobileUA);
            console.log("- Has orientation change:", hasOrientationChange);
            console.log("âž¡ï¸ RESULT: This device is a", isMobileDevice ? "MOBILE PHONE" : "COMPUTER");
            
            // Set device type as a data attribute on body for CSS targeting
            document.documentElement.setAttribute('data-device', isMobileDevice ? 'mobile' : 'desktop');
            
            return isMobileDevice;
        }
        
        // Run detection when DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            const isMobile = detectDevice();
            
            // Apply device-specific adjustments
            if (isMobile) {
                console.log("Applying mobile-specific adjustments...");
                
                // Add specific class for mobile quiz styling
                document.body.classList.add('mobile-device');
                
                // Apply index.html style quiz layout
                applyMobileQuizLayout();
            } else {
                console.log("Applying desktop-specific adjustments...");
                document.body.classList.add('desktop-device');
            }
        });
        
        // Function to apply index.html-style quiz layout for mobile
        function applyMobileQuizLayout() {
            // Wait for quiz elements to be available
            const applyMobileStyles = function() {
                const quizContainer = document.getElementById('quiz-container');
                const optionsContainer = document.getElementById('options-container');
                
                if (quizContainer) {
                    console.log("Applying mobile styles to quiz container");
                    
                    // Ensure options are in a single column on mobile
                    if (optionsContainer) {
                        // Remove forced columns if present
                        optionsContainer.style.gridTemplateColumns = '1fr';
                    }
                    
                    // Center question text for better mobile reading
                    const questionText = document.getElementById('question-text');
                    if (questionText) {
                        console.log("Centering question text for mobile");
                    }
                    
                    // Adjust feedback container for mobile
                    const feedbackContainer = document.getElementById('feedback-container');
                    if (feedbackContainer) {
                        console.log("Optimizing feedback container for mobile");
                        feedbackContainer.style.width = '90%';
                        feedbackContainer.style.maxWidth = '350px';
                    }
                }
            };
            
            // Apply immediately if elements exist
            applyMobileStyles();
            
            // Also apply when quiz is shown
            const checkQuizVisibility = setInterval(function() {
                const quizContainer = document.getElementById('quiz-container');
                if (quizContainer && quizContainer.style.display === 'block') {
                    applyMobileStyles();
                    clearInterval(checkQuizVisibility);
                }
            }, 500);
        }
        
        // Also detect on resize for responsive testing
        window.addEventListener('resize', function() {
            // Throttle resize event to avoid excessive calls
            if (this.resizeTimer) clearTimeout(this.resizeTimer);
            this.resizeTimer = setTimeout(function() {
                console.log("Window resized, re-checking device type...");
                detectDevice();
            }, 500);
        });
    </script>
    <style>
        :root {
            /* Light theme variables (default) */
            --bg-color: #f5f5f5;
            --app-bg: rgba(255, 255, 255, 0.95);
            --question-bg: rgba(240, 240, 240, 0.9);
            --text-color: #333333;
            --border-color: rgba(0, 0, 0, 0.2);
            --glow-color: rgba(0, 0, 0, 0.1);
            --inner-glow: rgba(0, 0, 0, 0.05);
            --header-bg: rgba(255, 255, 255, 0.3);
            --card-bg: rgba(255, 255, 255, 0.3);
            --accent-color: #85bb65;
            --accent-hover: rgba(133, 187, 101, 0.2);
            --overlay-bg: rgba(0, 0, 0, 0.5);
        }

        :root[data-theme="dark"] {
            /* Dark theme variables */
            --bg-color: #000000;
            --app-bg: rgba(64, 64, 64, 0.95);
            --question-bg: rgba(32, 32, 32, 0.9);
            --text-color: #ffffff;
            --border-color: rgba(255, 255, 255, 0.2);
            --glow-color: rgba(255, 255, 255, 0.15);
            --inner-glow: rgba(255, 255, 255, 0.1);
            --header-bg: rgba(64, 64, 64, 0.3);
            --card-bg: rgba(64, 64, 64, 0.3);
            --accent-color: #85bb65;
            --accent-hover: rgba(133, 187, 101, 0.2);
            --overlay-bg: rgba(0, 0, 0, 0.7);
        }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            transition: all 0.3s ease;
            position: relative;
            overflow-x: hidden;
            max-width: 100vw;
            width: 100%;
        }
        
        html {
            overflow-x: hidden;
            max-width: 100vw;
            width: 100%;
        }

        .background-illustrations {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .bg-element {
            position: absolute;
            border-radius: 50%;
            opacity: 0.25;
            transition: all 0.3s ease;
            filter: blur(50px);
            mix-blend-mode: screen;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.95));
            box-shadow: 0 0 100px rgba(255, 255, 255, 0.4);
        }

        .bg-element:nth-child(1) {
            width: min(400px, 40vw);
            height: min(400px, 40vw);
            top: -15vh;
            left: -10vw;
            animation: float 25s infinite ease-in-out;
            opacity: 0.3;
        }

        .bg-element:nth-child(2) {
            width: min(300px, 35vw);
            height: min(300px, 35vw);
            bottom: -10vh;
            right: -10vw;
            animation: float 20s infinite ease-in-out reverse;
            opacity: 0.25;
        }

        .bg-element:nth-child(3) {
            width: min(250px, 30vw);
            height: min(250px, 30vw);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: float 30s infinite ease-in-out;
            opacity: 0.2;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
            25% {
                transform: translate(min(100px, 8vw), min(100px, 8vh)) rotate(120deg) scale(1.1);
            }
            50% {
                transform: translate(0, min(200px, 15vh)) rotate(240deg) scale(1);
            }
            75% {
                transform: translate(min(-100px, -8vw), min(100px, 8vh)) rotate(360deg) scale(0.9);
            }
        }

        .app-container {
            background: var(--app-bg);
            border-radius: 20px;
            padding: 24px;
            width: min(90%, 600px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
                        0 0 30px var(--glow-color);
            position: relative;
            z-index: 1;
            margin: 20px auto;
            opacity: 0;
            animation: fadeIn 0.8s forwards;
            animation-delay: 0.2s;
            transition: height 0.5s cubic-bezier(0.4, 0.0, 0.2, 1); /* Added for height animation */
        }

        .step-container {
            display: none;
            opacity: 0;
            transform: translateY(0) scale(0.98);
            transition: opacity 0.8s cubic-bezier(0.4, 0.0, 0.2, 1), 
                        transform 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            position: absolute;
            width: 100%;
            left: 0;
            right: 0;
            padding: 10px;
            will-change: opacity, transform;
            backface-visibility: hidden;
        }

        .step-container.active {
            display: block;
            opacity: 1;
            transform: translateY(0) scale(1);
            position: relative;
            transition: opacity 0.8s cubic-bezier(0.4, 0.0, 0.2, 1), 
                        transform 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .step-container.fade-out {
            opacity: 0;
            transform: translateY(0) scale(0.98);
            transition: opacity 0.6s cubic-bezier(0.4, 0.0, 0.2, 1), 
                        transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .step-title {
            font-size: 2rem;
            color: var(--accent-color);
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }

        .step-description {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .option-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 2rem;
        }

        .option-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--question-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-item:hover {
            background: var(--accent-hover);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .option-item.selected {
            background: var(--accent-hover);
            border-color: var(--accent-color);
        }

        .option-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s ease;
        }

        .option-item.selected .option-checkbox {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }

        .option-item.selected .option-checkbox::after {
            content: "âœ“";
            color: white;
            font-size: 14px;
        }

        .option-label {
            font-size: 1.1rem;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: var(--question-bg);
            color: var(--text-color);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: var(--accent-hover);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn.next {
            background: var(--accent-color);
            color: white;
        }

        .nav-btn.prev {
            background: transparent;
            border: 1px solid var(--border-color);
        }

        .gold-button {
            display: none;
            margin: 1.5rem auto;
            padding: 12px 30px;
            background: linear-gradient(to bottom right, #FFD700, #B8860B);
            color: #000;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
            transition: all 0.3s ease, opacity 0.5s ease;
            position: relative;
            overflow: hidden;
            text-align: center;
            width: fit-content;
            opacity: 0;
        }

        .gold-button::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.6),
                rgba(255, 255, 255, 0)
            );
            transform: rotate(30deg);
            opacity: 0.5;
            pointer-events: none;
            animation: shine 1.5s infinite;
        }

        .gold-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.6);
        }

        @keyframes shine {
            0% {
                opacity: 0.5;
                left: -50%;
            }
            50% {
                opacity: 0.8;
            }
            100% {
                opacity: 0;
                left: 100%;
            }
        }

        /* Quiz - Updated to match index.html styling */
        .quiz-container {
            display: none;
            position: relative;
            z-index: 1;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        .question-wrapper {
            position: relative;
            z-index: 1;
            background: var(--question-bg);
            color: var(--text-color);
            border-radius: 15px;
            padding: 20px;
            margin: 0 0 20px 0;
            transform-origin: center;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        #question-text {
            color: var(--text-color);
            font-size: 1.5rem;
            margin: 0 0 20px 0;
            text-align: left;
            line-height: 1.4;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
        }

        #options-container {
            position: relative;
            z-index: 1;
            display: grid !important;
            grid-template-columns: repeat(2, 1fr) !important;
            grid-gap: 15px;
            margin-top: 20px;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        .option-btn {
            position: relative;
            z-index: 1;
            background: var(--app-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
            line-height: 1.3;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer; /* Added for better UX */
        }

        .option-btn:hover {
            background: var(--accent-hover);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .option-btn:active {
            transform: translateY(1px);
        }

        .option-btn.correct {
            background: rgba(0, 128, 0, 0.7);
            border-color: #00ff00;
            animation: glow 1.5s infinite;
        }

        .option-btn.incorrect {
            background: rgba(128, 0, 0, 0.7);
            border-color: #ff0000;
            animation: shake 0.5s;
        }

        .option-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .option-btn:active::after {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.3;
            transition: 0s;
        }

        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-text {
            font-size: 1.1rem;
            font-weight: 500;
        }

        #progress-bar {
            width: 100%;
            height: 8px; /* Increased from 6px to 8px */
            background-color: var(--border-color);
            border-radius: 4px; /* Adjusted for new height */
            margin-bottom: 2rem;
            overflow: hidden;
            position: relative; /* Added for shine pseudo-element positioning */
        }
        
        #progress-indicator {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%; /* Start at 0% */
            transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
            border-radius: 4px; /* Ensure inner bar also has rounded corners */
            position: relative; /* Added for shine */
            overflow: hidden; /* Ensures shine stays within bounds */
        }

        #progress-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%; /* Start off-screen to the left */
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: progressShine 2s infinite linear;
        }

        @keyframes progressShine {
            0% {
                left: -100%;
            }
            50% {
                left: 100%;
            }
            100% {
                left: 100%; /* Keep it off-screen at the end before reset */
            }
        }
        
        /* Add transition overlay for smooth page transitions */
        .page-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--accent-color);
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .page-transition-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .feedback-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--app-bg);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 45;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 90%;
            width: 450px;
        }

        .feedback-container.visible {
            opacity: 1;
            visibility: visible;
            animation: fadeInUp 0.5s;
        }

        .feedback-container.hidden {
            visibility: hidden;
            opacity: 0;
            display: none;
        }

        .feedback-message {
            font-size: 1.5rem;
            color: var(--text-color);
            margin-bottom: 15px;
            display: block;
        }

        .explanation {
            font-size: 1.1rem;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 20px;
            display: block;
        }

        #continue-btn {
            background: linear-gradient(45deg, #008000, #00a000);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 128, 0, 0.3);
            display: block !important;
            width: auto;
            min-width: 200px;
            position: relative;
            z-index: 100;
            overflow: hidden;
        }

        #continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 128, 0, 0.4);
        }

        #continue-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(0, 128, 0, 0.2);
        }
        
        /* Page entry animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile responsiveness */
        @media (max-width: 600px) {
            #options-container {
                grid-template-columns: 1fr !important;
                width: 100% !important;
                grid-gap: 10px;
            }
            
            .option-btn {
                width: 100% !important;
                box-sizing: border-box;
                overflow-wrap: break-word;
                word-wrap: break-word;
                hyphens: auto;
                display: block;
                text-align: left;
                white-space: normal;
                line-height: 1.3;
                font-size: 1rem;
                padding: 12px;
            }
            
            .question-wrapper {
                padding: 15px;
                margin: 0 0 15px 0;
                width: 100%;
                box-sizing: border-box;
            }
            
            #question-text {
                font-size: 1.25rem;
                line-height: 1.4;
                margin-bottom: 15px;
                text-align: left;
            }
            
            .app-container {
                width: 95%;
                padding: 15px;
                margin: 10px auto;
                max-width: 450px;
            }
            
            .feedback-container {
                width: 90%;
                max-width: 350px;
                padding: 20px;
            }
            
            .feedback-message, #feedback-text {
                font-size: 1.1rem;
                line-height: 1.4;
            }
            
            .explanation {
                font-size: 0.95rem;
                line-height: 1.4;
            }
            
            #continue-btn {
                min-width: 180px;
                padding: 10px 20px;
            }
            
            .progress-container {
                margin-bottom: 8px;
            }
            
            .progress-text {
                font-size: 0.9rem;
            }
            
            /* Improve full screen handling */
            body, html {
                max-width: 100vw;
                overflow-x: hidden;
            }
        }
        
        /* Small phones */
        @media (max-width: 380px) {
            .app-container {
                width: 98%;
                padding: 12px;
            }
            
            .question-wrapper {
                padding: 12px;
            }
            
            #question-text {
                font-size: 1.1rem;
            }
            
            .option-btn {
                padding: 10px;
                font-size: 0.9rem;
            }
        }

        /* Add enhanced animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            15%, 45%, 75% { transform: translateX(-10px); }
            30%, 60%, 90% { transform: translateX(10px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOutDown {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(0, 128, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(0, 128, 0, 0.8); }
            100% { box-shadow: 0 0 5px rgba(0, 128, 0, 0.5); }
        }

        .question-exit {
            opacity: 0;
            transform: translateX(-50px);
        }

        .question-enter {
            opacity: 0;
            transform: translateX(50px);
        }

        .feedback-container.correct {
            border: 2px solid #00ff00;
        }

        .feedback-container.incorrect {
            border: 2px solid #ff0000;
        }

        .feedback-container.visible {
            opacity: 1;
            visibility: visible;
            animation: fadeInUp 0.5s;
        }

        /* Improve the shine animation for the continue button */
        #continue-btn::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 50%;
            height: 300%;
            background: linear-gradient(
                to right,
                rgba(255, 255, 255, 0),
                rgba(255, 255, 255, 0.6),
                rgba(255, 255, 255, 0)
            );
            transform: rotate(30deg);
            animation: continueBtnShine 4s infinite;  /* Increased from 2s to 4s for slower animation */
            pointer-events: none;
        }

        /* Create a new animation specifically for the continue button */
        @keyframes continueBtnShine {
            0% {
                left: -100%;
            }
            30%, 100% {  /* Adjusted from 20% to 30% for a slower, more deliberate shine */
                left: 200%;
            }
        }

        /* Confetti canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        /* Progress animation */
        .progress-fill-animation {
            transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Add css for confetti fade out */
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        .confetti-fade-out {
            animation: fadeOut 0.5s forwards;
        }

        /* Overlay styles */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay-bg);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 40;
            pointer-events: none;
        }

        #overlay.active {
            opacity: 0.5;
            visibility: visible;
            pointer-events: auto;
            z-index: 1000; /* Ensure this is high enough, but below feedback-container */
        }

        /* Add transition styles for questions */
        .slide-out-left {
            animation: slideOutLeft 0.5s forwards cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .slide-in-right {
            animation: slideInRight 0.5s forwards cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        @keyframes slideOutLeft {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(-50px);
                opacity: 0;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(50px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Enhanced progress bar animation */
        .progress-indicator-animate {
            transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* Style for feedback messages */
        .step-feedback {
            /* min-height: 40px; */ /* Removed to prevent reserving space */
            /* margin-top: 20px; */  /* Removed to prevent reserving space */
            height: 0; /* Ensure it takes no vertical space */
            overflow: hidden; /* Prevent any accidental content visibility */
            text-align: center;
            color: var(--accent-color);
            font-size: 1.1rem;
            font-weight: 500;
            /* opacity: 0; */ /* No longer needed as it won't be shown */
            /* transform: translateY(10px); */ /* No longer needed */
            /* transition: opacity 0.3s ease, transform 0.3s ease; */ /* No longer needed */
        }
        
        /* .step-feedback.active class is no longer used for visibility here, can be removed or left if other uses exist */
        /*
        .step-feedback.active {
            opacity: 1;
            transform: translateY(0);
        }
        */

        /* Financial term tooltip styling */
        .financial-term {
            text-decoration: underline dotted var(--accent-color);
            cursor: help;
            position: relative;
            display: inline-block;
        }

        /* Tippy tooltip custom theme */
        .tippy-box[data-theme~='finance'] {
            background-color: var(--app-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            font-size: 0.9rem;
            max-width: 300px;
            padding: 5px;
        }

        .tippy-box[data-theme~='finance'] .tippy-content {
            padding: 10px 12px;
        }

        .tippy-box[data-theme~='finance'][data-placement^='top'] > .tippy-arrow::before {
            border-top-color: var(--app-bg);
        }

        .tippy-box[data-theme~='finance'][data-placement^='bottom'] > .tippy-arrow::before {
            border-bottom-color: var(--app-bg);
        }

        .tippy-box[data-theme~='finance'][data-placement^='left'] > .tippy-arrow::before {
            border-left-color: var(--app-bg);
        }

        .tippy-box[data-theme~='finance'][data-placement^='right'] > .tippy-arrow::before {
            border-right-color: var(--app-bg);
        }

        /* Remove signup prompt styles as they're no longer used */
        /* Add iPhone animation styles */
        .iphone-container {
            position: fixed;
            bottom: -100%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            transition: bottom 1s cubic-bezier(0.33, 1, 0.68, 1);
            text-align: center;
            width: 100%;
            max-width: 700px; /* Increased from 400px to 700px */
        }
        
        .iphone-container.active {
            bottom: 50%;
            transform: translate(-50%, 50%);
        }
        
        /* Add hovering animation */
        @keyframes hover {
            0% {
                transform: translate(-50%, 50%);
            }
            50% {
                transform: translate(-50%, 48%); /* Move slightly up */
            }
            100% {
                transform: translate(-50%, 50%);
            }
        }
        
        .iphone-container.hovering {
            animation: hover 3s ease-in-out infinite;
        }
        
        .iphone-image {
            width: 100%;
            max-width: 500px; /* Increased from 300px to 500px */
            display: block;
            margin: 0 auto;
            position: relative;
        }
        
        .continue-btn {
            position: absolute;
            bottom: 12%; /* Adjusted from 18% to 12% to move button down */
            left: 50%;
            transform: translateX(-50%) translateY(20px); /* Initial position with offset */
            padding: 12px 30px;
            background: var(--accent-color);
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            width: 60%; /* Width relative to the iPhone */
            max-width: 240px;
            transition: opacity 0.5s ease, transform 0.5s ease;
            display: none;
            z-index: 101; /* Ensure it's above the iPhone image */
        }
        
        .continue-btn.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0); /* Final position */
            display: block;
        }
        
        .continue-btn:hover {
            transform: translateX(-50%) translateY(-5px); /* Simple upward hover effect */
        }
        
        .continue-btn:active {
            transform: translateX(-50%) translateY(0); /* Return to original position when clicked */
        }

        /* Dark blurred overlay */
        .dark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark with 70% opacity */
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 90; /* Below the iPhone container */
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .dark-overlay.active {
            opacity: 1;
        }

        /* Device-specific styles */
        html[data-device="mobile"] {
            /* Mobile-specific base styles */
            --mobile-padding: 12px;
            --mobile-font-size-adjust: 0.9;
        }
        
        html[data-device="desktop"] {
            /* Desktop-specific base styles */
            --desktop-padding: 20px;
            --desktop-font-size-adjust: 1;
        }
        
        /* Apply device-specific styling based on the data-device attribute */
        html[data-device="mobile"] .app-container {
            width: 95%;
            padding: var(--mobile-padding);
            margin: 10px auto;
            border-radius: 15px;
        }
        
        html[data-device="mobile"] .question-wrapper {
            padding: var(--mobile-padding);
            border-radius: 12px;
        }
        
        html[data-device="mobile"] #options-container {
            grid-template-columns: 1fr !important;
            grid-gap: 10px;
        }
        
        html[data-device="mobile"] .option-btn {
            padding: 12px;
            font-size: calc(1rem * var(--mobile-font-size-adjust));
        }
        
        html[data-device="mobile"] #question-text {
            font-size: 1.2rem;
            line-height: 1.4;
        }
        
        /* Add debug indicator in development */
        html::after {
            content: attr(data-device);
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
            pointer-events: none;
            opacity: 0.7;
        }

        /* Mobile-specific question layout from index.html */
        html[data-device="mobile"] .question-wrapper {
            background: var(--question-bg);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            position: static;
            margin: 20px 0;
            transform-origin: unset;
            max-width: 100%;
        }
        
        html[data-device="mobile"] #options-container {
            display: grid !important;
            grid-template-columns: 1fr !important;
            gap: 15px;
            margin-top: 20px;
            width: 100%;
            position: static;
            z-index: 1;
        }
        
        html[data-device="mobile"] .option-btn {
            background: var(--app-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: static;
            overflow: hidden;
            overflow-wrap: break-word;
            word-wrap: break-word;
            hyphens: auto;
            width: 100%;
            box-sizing: border-box;
        }
        
        html[data-device="mobile"] #question-text {
            font-size: 1.2rem;
            color: var(--text-color);
            margin-bottom: 15px;
            text-align: center; /* Center align like in index.html */
            line-height: 1.4;
        }
        
        /* For smaller devices, further reduce padding and font sizes */
        @media (max-width: 380px) {
            html[data-device="mobile"] .question-wrapper {
                padding: 15px;
            }
            
            html[data-device="mobile"] .option-btn {
                padding: 12px;
                font-size: 0.95rem;
            }
            
            html[data-device="mobile"] #question-text {
                font-size: 1.1rem;
            }
        }

        /* Mobile Quiz Layout Class */
        .mobile-quiz .question-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 20px 0;
            background: var(--question-bg);
            border-radius: 15px;
            position: static;
            transform-origin: unset;
        }
        
        .mobile-quiz #question-text {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .mobile-quiz #options-container {
            display: grid !important;
            grid-template-columns: 1fr !important;
            gap: 15px;
            width: 100%;
            max-width: 100%;
            margin-top: 20px;
        }
        
        .mobile-quiz .option-btn {
            background: var(--app-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: static;
            z-index: 1;
            overflow-wrap: break-word;
            word-wrap: break-word;
            width: 100%;
            box-sizing: border-box;
        }
        
        .mobile-quiz .option-btn:hover {
            background: var(--accent-hover);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }
        
        .mobile-quiz .feedback-container {
            width: 90%;
            max-width: 350px;
            padding: 20px;
        }
        
        .mobile-quiz .feedback-message,
        .mobile-quiz #feedback-text {
            font-size: 1.1rem;
            line-height: 1.4;
        }
        
        /* Additional enhancements for smaller screens */
        @media (max-width: 380px) {
            .mobile-quiz .question-wrapper {
                padding: 15px;
            }
            
            .mobile-quiz .option-btn {
                padding: 12px;
                font-size: 0.95rem;
            }
            
            .mobile-quiz #question-text {
                font-size: 1.1rem;
            }
        }

        /* Add new styles for Happy Uncle animations */
        .happy-uncle-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.8s ease;
            display: flex; /* Ensures flex layout */
            flex-direction: column; /* Stacks children vertically */
            align-items: center; /* Centers children horizontally */
            justify-content: center;
            width: 100%; /* Adjusted for better centering if content is wide */
            height: 100%; /* Adjusted for better centering */
        }

        .happy-uncle-container.visible {
            opacity: 1;
        }

        .happy-uncle-image {
            width: 225px; /* 75% of 300px */
            height: auto;
            /* margin-bottom: 20px; Removed, spacing handled by message/button */
        }

        .happy-uncle-image.floating {
            animation: float 3s ease-in-out infinite;
        }

        /* Restore missing container animation classes */
        .happy-uncle-container.flipped {
            transform: translate(-50%, -50%) scaleX(-1);
        }

        .happy-uncle-container.top-left {
            top: 20px;
            left: 20px;
            transform: none; /* Remove transform from the container itself */
            width: auto;
            height: auto;
        }

        /* Apply scaling and flipping only to the image when in top-left */
        .happy-uncle-container.top-left .happy-uncle-image {
            transform: scale(0.65) scaleX(-1); /* Changed from scale(0.5) */
            /* Adjust margins if needed for positioning relative to message */
        }

        /* Adjust message style when in top-left */
        .happy-uncle-container.top-left .uncle-message {
            position: absolute; /* Key for placement and preventing layout shift */
            transform: none; /* Ensure no inherited transform */
            font-size: 0.9rem;
            padding: 8px 12px;
            margin-bottom: 0; /* Not needed for absolute positioning */
            max-width: 200px;
            /* display: block; /* JS handles visibility via .visible class and opacity */
            /* Positioning: above and slightly right of Jigu. Container is at top:20px, left:20px */
            /* Jigu's image (scaled 0.65) is approx 146.25px wide. */ /* Updated comment */
            top: -5px;  /* Adjusted from -15px to move it down */
            left: 90px;   /* Adjusted from 70px. Position left of message ~90px from container's left. (Jigu image LTR is 0-146.25px) */ /* Updated comment and value */
            z-index: 10; /* Ensure message is above Jigu's image */
            opacity: 0; /* Start transparent, JS adds .visible to fade in */
        }

        .happy-uncle-container.top-left .uncle-message.visible {
            opacity: 1; /* This will use the existing transition on .uncle-message */
        }

        /* Adjust tail for top-left message to point towards Jigu (down-left) */
        .happy-uncle-container.top-left .uncle-message::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-top: 10px solid #2E3B4E; /* Color of the bubble */
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            /* Position tail at the bottom of the bubble, shifted left */
            bottom: -10px; 
            left: 30%; /* Puts the point of the tail towards the left side of the bubble */
            transform: translateX(-50%); /* Centers the base of the tail at this 30% mark */
        }

        .happy-uncle-container.slide-out {
            animation: slideOut 1s forwards;
        }

        .happy-uncle-container.slide-in {
            animation: slideIn 1s forwards;
        }
        /* End of restored classes */

        .uncle-message {
            position: relative; /* For the tail */
            background: #2E3B4E; /* Dark chat bubble background */
            color: #FFFFFF; /* White text */
            padding: 15px 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.5s ease;
            margin-bottom: 20px; /* Space between chatbox and image */
            max-width: 320px;
        }

        .uncle-message::after { /* Chat bubble tail */
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #2E3B4E; /* Match chatbox background */
        }

        .uncle-continue-btn {
            margin-top: 30px;
            padding: 12px 30px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .uncle-continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .uncle-continue-btn.visible {
            opacity: 1;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(-50%, -50%);
            }
            50% {
                transform: translate(-50%, calc(-50% - 20px));
            }
        }

        @keyframes slideOut {
            from {
                transform: translate(-50%, -50%) scaleX(-1);
            }
            to {
                transform: translate(150%, -50%) scaleX(-1);
            }
        }

        @keyframes slideIn {
            from {
                transform: translate(-150%, 0); /* Only translation, no scale or flip */
            }
            to {
                transform: translate(0, 0);     /* Only translation, no scale or flip */
            }
        }

        @keyframes float-top-left {
            0%, 100% {
                transform: scale(0.65) scaleX(-1) translateY(0px); /* Changed from scale(0.5) */
            }
            50% {
                transform: scale(0.65) scaleX(-1) translateY(-10px); /* Gentle hover up, maintaining scale and flip */ /* Changed from scale(0.5) */
            }
        }

        .happy-uncle-image.floating-top-left {
            animation: float-top-left 2s ease-in-out infinite;
        }

        @keyframes float-top-left-message {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px); /* Matches Jigu image hover distance */
            }
        }

        .happy-uncle-container.top-left .uncle-message.floating-top-left-message {
            animation: float-top-left-message 2s ease-in-out infinite; /* Same timing as Jigu image */
        }

        /* New keyframes for individual element floating */
        @keyframes jiguElementsFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px); /* Vertical float distance */
            }
        }

        /* Hide the main content initially */
        .app-container {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .app-container.visible {
            opacity: 1;
            visibility: visible;
        }

        .happy-uncle-container.floating { /* Changed selector from .happy-uncle-image to .happy-uncle-container */
            /* animation: float 3s ease-in-out infinite; */ /* Removed animation from container */
        }

        /* Apply new float animation to image and message when container is floating */
        .happy-uncle-container.floating .happy-uncle-image,
        .happy-uncle-container.floating .uncle-message {
            animation: jiguElementsFloat 3s ease-in-out infinite;
        }

        .uncle-message.visible {
            opacity: 1;
        }

        /* Restore missing container animation classes */
        .happy-uncle-container.flipped {
            transform: translate(-50%, -50%) scaleX(-1);
        }

        .happy-uncle-container.top-left {
            top: 20px;
            left: 20px;
            transform: none; /* Remove transform from the container itself */
            width: auto;
            height: auto;
        }

        /* Apply scaling and flipping only to the image when in top-left */
        .happy-uncle-container.top-left .happy-uncle-image {
            transform: scale(0.65) scaleX(-1); /* Changed from scale(0.5) */
            /* Adjust margins if needed for positioning relative to message */
        }

        /* Adjust message style when in top-left */
        .happy-uncle-container.top-left .uncle-message {
            position: absolute; /* Key for placement and preventing layout shift */
            transform: none; /* Ensure no inherited transform */
            font-size: 0.9rem;
            padding: 8px 12px;
            margin-bottom: 0; /* Not needed for absolute positioning */
            max-width: 200px;
            /* display: block; /* JS handles visibility via .visible class and opacity */
            /* Positioning: above and slightly right of Jigu. Container is at top:20px, left:20px */
            /* Jigu's image (scaled 0.65) is approx 146.25px wide. */ /* Updated comment */
            top: -5px;  /* Adjusted from -15px to move it down */
            left: 90px;   /* Adjusted from 70px. Position left of message ~90px from container's left. (Jigu image LTR is 0-146.25px) */ /* Updated comment and value */
            z-index: 10; /* Ensure message is above Jigu's image */
            opacity: 0; /* Start transparent, JS adds .visible to fade in */
        }

        .happy-uncle-container.top-left .uncle-message.visible {
            opacity: 1; /* This will use the existing transition on .uncle-message */
        }

        /* Adjust tail for top-left message to point towards Jigu (down-left) */
        .happy-uncle-container.top-left .uncle-message::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-top: 10px solid #2E3B4E; /* Color of the bubble */
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            /* Position tail at the bottom of the bubble, shifted left */
            bottom: -10px; 
            left: 30%; /* Puts the point of the tail towards the left side of the bubble */
            transform: translateX(-50%); /* Centers the base of the tail at this 30% mark */
        }

        .happy-uncle-container.slide-out {
            animation: slideOut 1s forwards;
        }

        .happy-uncle-container.slide-in {
            animation: slideIn 1s forwards;
        }
        /* End of restored classes */
    </style>
    <style>
        /* Add styles for the accomplishment list */
        .accomplishment-list {
            list-style-type: none;
            padding-left: 20px; /* Add some padding for alignment */
            margin-bottom: 2rem;
            text-align: left; /* Ensure text is aligned left */
        }

        .accomplishment-list li {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start; /* Align emoji to the top of the text */
        }

        .accomplishment-list li .emoji-bullet {
            font-size: 1.5rem; /* Slightly larger emoji */
            margin-right: 12px;
            line-height: 1; /* Adjust line height for better vertical alignment with text */
            min-width: 30px; /* Ensure consistent spacing for emoji */
        }
        /* End of styles for accomplishment list */
    </style>
    <style>
        /* New styles for the updated quiz layout based on the image */
        .quiz-container.active-quiz-layout #progress-bar {
            display: none; /* Hide main progress bar when new quiz layout is active */
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            /* background: var(--app-bg); /* Or var(--question-bg) depending on desired look */
            /* border-bottom: 1px solid var(--border-color); */
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .quiz-back-button,
        .quiz-settings-button {
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .quiz-back-button:hover,
        .quiz-settings-button:hover {
            color: var(--accent-color);
        }

        .quiz-progress-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1; /* Allows it to take up space for centering progress bar */
            margin: 0 15px; /* Spacing from buttons */
        }

        .quiz-progress-info .progress-text {
            font-size: 0.9rem; /* Slightly smaller than before */
            margin-bottom: 5px;
            font-weight: 500;
        }

        #quiz-page-progress-bar-container {
            width: 100%;
            max-width: 250px; /* Control max width of progress bar */
            height: 6px;
            background-color: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
        }

        #quiz-page-progress-bar-indicator {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%; /* Start at 0% */
            transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
            border-radius: 3px;
        }

        /* Main content area for question and options */
        .question-display-area {
            background: var(--app-bg); /* Main background for this section */
            border-radius: 15px;
            padding: 20px;
            /* box-shadow: 0 4px 15px rgba(0,0,0,0.1); */ /* Optional subtle shadow */
        }

        .question-text-wrapper {
            background: var(--question-bg); /* Darker background for question text area */
            color: var(--text-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px; /* Space before options */
            display: flex;
            align-items: center; /* Vertically align icon and text */
            text-align: left;
        }

        .question-icon-area {
            font-size: 1.3rem; /* Adjust icon size as needed */
            margin-right: 15px; /* Space between icons and text */
            display: flex;
            align-items: center;
        }

        /* Overriding existing #question-text to match the new design */
        #question-text {
            font-size: 1.25rem; /* As per image */
            color: var(--text-color);
            margin: 0; /* Remove previous margins */
            line-height: 1.4;
            flex-grow: 1; /* Allow text to take remaining space */
            text-align: left; /* Ensure it stays left */
        }

        /* Overriding existing #options-container for the 2x2 grid layout */
        #options-container {
            display: grid !important;
            grid-template-columns: repeat(2, 1fr) !important; /* Force 2 columns */
            grid-gap: 15px;
            margin-top: 0; /* Reset from previous margin */
            width: 100%;
        }

        /* Overriding existing .option-btn styles */
        .option-btn {
            background: var(--question-bg); /* Darker background like question wrapper */
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            font-size: 0.95rem; /* Adjust as needed for text fit */
            text-align: left;
            width: 100%; /* Ensure buttons take full width of grid cell */
            box-sizing: border-box;
            line-height: 1.3;
            min-height: 60px; /* Ensure buttons have a decent tap target height */
            display: flex; /* For vertical centering of text if needed */
            align-items: center; /* For vertical centering of text if needed */
            cursor: pointer; /* Added for better UX */
        }

        .option-btn:hover {
            background: var(--accent-hover);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Ensure quiz container takes up appropriate space */
        .quiz-container {
            width: 100%;
            max-width: 100%; /* Ensures it uses app-container width */
            /* padding: 0 10px; Remove padding if app-container provides it */
            box-sizing: border-box;
        }

        /* Ensure app-container adjusts height when quiz is shown */
        .app-container.quiz-active {
            height: auto !important; /* Allow height to be determined by content */
        }

        /* Hide the previous question-wrapper when new layout is active */
        .quiz-container.active-quiz-layout .question-wrapper {
             display: none;
        }

        /* Mobile adjustments for new quiz layout */
        @media (max-width: 600px) {
            .quiz-header {
                padding: 10px 15px;
                margin-bottom: 15px;
            }
            .question-display-area {
                padding: 15px;
            }
            .question-text-wrapper {
                padding: 15px;
                margin-bottom: 20px;
            }
            #question-text {
                font-size: 1.1rem;
            }
            .question-icon-area {
                font-size: 1.1rem;
                margin-right: 10px;
            }
            #options-container {
                grid-template-columns: 1fr !important; /* Single column on mobile */
                grid-gap: 10px;
            }
            .option-btn {
                padding: 12px;
                font-size: 0.9rem;
                min-height: 50px;
            }
            .quiz-progress-info .progress-text {
                font-size: 0.8rem;
            }
            #quiz-page-progress-bar-container {
                 max-width: 180px;
            }
        }
    </style>
</head>

<body>
    <!-- Add Happy Uncle container -->
    <div class="happy-uncle-container">
        <div class="uncle-message">Hi There! Im Jignesh, but you can call me Jigu</div>
        <img src="assets/images/happy uncle.png" alt="Happy Uncle" class="happy-uncle-image">
        <button class="uncle-continue-btn">Continue</button>
    </div>

    <div class="page-transition-overlay" id="page-transition"></div>
    
    <div class="background-illustrations">
        <div class="bg-element"></div>
        <div class="bg-element"></div>
        <div class="bg-element"></div>
    </div>

    <!-- Add confetti canvas -->
    <canvas id="confetti-canvas"></canvas>

    <div class="app-container">
        <div id="progress-bar">
            <div id="progress-indicator"></div>
        </div>

        <!-- Step 1 -->
        <div class="step-container active" id="step1">
            <h2 class="step-title">Why are you here?</h2>
            <p class="step-description">What's your money mission?</p>
            <div class="option-list">
                <div class="option-item" data-value="save_better">
                    <div class="option-checkbox"></div>
                    <span class="option-label">I want to save better</span>
                </div>
                <div class="option-item" data-value="stop_wasting">
                    <div class="option-checkbox"></div>
                    <span class="option-label">I want to stop wasting money</span>
                </div>
                <div class="option-item" data-value="smarter_than_parents">
                    <div class="option-checkbox"></div>
                    <span class="option-label">I want to be smarter than my parents with money</span>
                </div>
                <div class="option-item" data-value="exploring">
                    <div class="option-checkbox"></div>
                    <span class="option-label">Just exploring</span>
                </div>
            </div>
            <!-- Add feedback message container -->
            <div id="step1-feedback" class="step-feedback"></div>
            <div class="navigation">
                <button class="nav-btn prev" disabled>Back</button>
                <button class="nav-btn next" id="next1" disabled>Next</button>
            </div>
        </div>

        <!-- Step 2 -->
        <div class="step-container" id="step2">
            <h2 class="step-title">How much time can you give it?</h2>
            <p class="step-description">No fluff. Just fast lessons that work.</p>
            <div class="option-list">
                <div class="option-item" data-value="casual">
                    <div class="option-checkbox"></div>
                    <span class="option-label">5 min a day (Casual)</span>
                </div>
                <div class="option-item" data-value="focused">
                    <div class="option-checkbox"></div>
                    <span class="option-label">10 min (Focused)</span>
                </div>
                <div class="option-item" data-value="olympian">
                    <div class="option-checkbox"></div>
                    <span class="option-label">15+ min (Olympian mode)</span>
                </div>
            </div>
            <!-- Add feedback message container -->
            <div id="step2-feedback" class="step-feedback"></div>
            <div class="navigation">
                <button class="nav-btn prev">Back</button>
                <button class="nav-btn next" id="next2" disabled>Next</button>
            </div>
        </div>

        <!-- Step 3 -->
        <div class="step-container" id="step3">
            <h2 class="step-title">Pick your starting point</h2>
            <p class="step-description">Money stuff at school? Never heard of it.</p>
            <div class="option-list">
                <div class="option-item" data-value="zero">
                    <div class="option-checkbox"></div>
                    <span class="option-label">I'm starting from zero</span>
                </div>
                <div class="option-item" data-value="some_knowledge">
                    <div class="option-checkbox"></div>
                    <span class="option-label">I know a bit already</span>
                </div>
                <div class="option-item" data-value="quiz">
                    <div class="option-checkbox"></div>
                    <span class="option-label">Let me take a short quiz and place me</span>
                </div>
            </div>
            <!-- Add feedback message container -->
            <div id="step3-feedback" class="step-feedback"></div>
            <div class="navigation">
                <button class="nav-btn prev">Back</button>
                <button class="nav-btn next" id="next3" disabled>Next</button>
            </div>
        </div>

        <!-- Step 3.5: What you'll accomplish -->
        <div class="step-container" id="step3_5">
            <h2 class="step-title">What you'll accomplish:</h2>
            <ul class="accomplishment-list" id="accomplishmentList">
                <!-- Accomplishments will be dynamically inserted here -->
            </ul>
            <div class="navigation">
                <button class="nav-btn prev">Back</button>
                <button class="nav-btn next" id="next3_5">Next</button>
            </div>
        </div>

        <!-- Step 4 -->
        <div class="step-container" id="step4">
            <h2 class="step-title">Start your first challenge</h2>
            <p class="step-description">You'll learn by doing. No boring lectures. Jump into your first challenge and start earning points for getting smarter.</p>
            <div id="letsgo-button-container" style="text-align: center;">
                <!-- Gold button will appear here after 2 seconds -->
            </div>
            <div class="navigation">
                <button class="nav-btn next" disabled style="visibility: hidden;">Next</button>
            </div>
        </div>

        <!-- New Quiz Container (Styled like index.html) -->
        <div class="quiz-container" id="quiz-container">
            <!-- New Quiz Header -->
            <div class="quiz-header">
                <span class="quiz-back-button"><i class="fas fa-arrow-left" aria-hidden="true"></i></span>
                <div class="quiz-progress-info">
                    <span id="quiz-progress-text" class="progress-text">1/X</span>
                    <div id="quiz-page-progress-bar-container">
                        <div id="quiz-page-progress-bar-indicator"></div>
                    </div>
                </div>
                <span class="quiz-settings-button"><i class="fas fa-cog" aria-hidden="true"></i></span>
            </div>

            <!-- Main quiz content: question and options -->
            <div id="current-question-display" class="question-display-area">
                <div class="question-text-wrapper">
                    <span class="question-icon-area">
                        <!-- Placeholder icons, can be changed or made dynamic if needed -->
                        <i class="fas fa-chart-line" aria-hidden="true" style="color: #5cacee;"></i><i class="fas fa-home" aria-hidden="true" style="color: #f7aa47; margin-left: 5px;"></i>
                    </span>
                    <h2 id="question-text">What is a property lien?</h2>
                </div>
                <div id="options-container">
                    <!-- Options will be dynamically filled by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback container - exactly like index.html -->
    <div id="overlay" class="overlay"></div>
    <div id="feedback-container" class="hidden">
        <p id="feedback-text"></p>
        <button id="continue-btn">Continue to Next Question ðŸ‘</button>
    </div>

    <!-- Add Tippy.js before your custom scripts -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add new script for Happy Uncle animations
            const happyUncleContainer = document.querySelector('.happy-uncle-container');
            const uncleMessage = document.querySelector('.uncle-message');
            const uncleContinueBtn = document.querySelector('.uncle-continue-btn');
            const appContainer = document.querySelector('.app-container');
            const happyUncleImage = document.querySelector('.happy-uncle-image'); // Define happyUncleImage
            let animationStep = 0;

            // Hide the main content initially
            appContainer.style.visibility = 'hidden';
            appContainer.style.opacity = '0';

            // Start the animation sequence
            setTimeout(() => {
                happyUncleContainer.classList.add('visible');
                setTimeout(() => {
                    happyUncleContainer.classList.add('floating');
                    setTimeout(() => {
                        uncleMessage.classList.add('visible');
                        setTimeout(() => {
                            uncleContinueBtn.classList.add('visible');
                        }, 500);
                    }, 500);
                }, 500);
            }, 500);

            // Handle continue button clicks
            uncleContinueBtn.addEventListener('click', () => {
                // Fade out current message
                uncleMessage.classList.remove('visible');

                setTimeout(() => {
                    if (animationStep === 0) {
                        // After "Hi There! Im Jignesh..."
                        uncleMessage.textContent = "Let's get started!";
                        animationStep++;
                    } else if (animationStep === 1) {
                        // After "Let's get started!"
                        uncleMessage.textContent = "I'm going to ask you some questions so I can get to know you better!";
                        animationStep++;
                    } else if (animationStep === 2) {
                        // After "I'm going to ask you some questions..."
                        // This part handles Jigu moving to the top-left, so message visibility is handled differently here.
                        happyUncleContainer.classList.remove('floating'); // Stop central floating
                        // uncleMessage.classList.remove('visible'); // Already removed above for the text change fade
                        uncleContinueBtn.classList.remove('visible'); // Triggers 0.5s opacity transition

                        setTimeout(() => { // Wait for button to fade out (0.5s)
                            uncleMessage.style.display = 'none'; // Now remove from layout
                            uncleContinueBtn.style.display = 'none'; // Now remove from layout

                            happyUncleContainer.classList.add('flipped');

                            setTimeout(() => { // Wait for flip to be noticeable (e.g., 0.3s)
                                happyUncleContainer.classList.add('slide-out');

                                // Listen for the end of the slide-out animation
                                happyUncleContainer.addEventListener('animationend', function handleSlideOutAnimationEnd(event) {
                                    if (event.animationName === 'slideOut') {
                                        happyUncleContainer.removeEventListener('animationend', handleSlideOutAnimationEnd);

                                        happyUncleContainer.classList.remove('visible');
                                        happyUncleContainer.classList.remove('slide-out');
                                        happyUncleContainer.classList.remove('flipped');

                                        happyUncleContainer.classList.add('top-left');
                                        
                                        void happyUncleContainer.offsetWidth;
                                        happyUncleContainer.classList.add('visible');
                                        happyUncleContainer.classList.add('slide-in');

                                        appContainer.style.visibility = 'visible';
                                        appContainer.classList.add('visible');

                                        happyUncleContainer.addEventListener('animationend', function handleSlideInAnimationEnd(event) {
                                            if (event.animationName === 'slideIn') {
                                                happyUncleContainer.removeEventListener('animationend', handleSlideInAnimationEnd);
                                                happyUncleImage.classList.add('floating-top-left');
                                                if (uncleMessage.classList.contains('visible')) {
                                                    uncleMessage.classList.add('floating-top-left-message');
                                                }
                                            }
                                        });
                                    }
                                });
                            }, 300); 
                        }, 500); 
                        animationStep++;
                        return; // Exit early to prevent message fade-in if Jigu is moving
                    }
                    // Fade in new message
                    uncleMessage.classList.add('visible');
                }, 500); // This timeout matches the opacity transition duration (0.5s)
            });

            // Add the index.html styles for feedback
            const feedbackStyles = document.createElement('style');
            feedbackStyles.textContent = `
                /* Overlay styles */
                #overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: var(--overlay-bg);
                    opacity: 0;
                    visibility: hidden;
                    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                    z-index: 40;
                    pointer-events: none;
                }

                #overlay.active {
                    opacity: 0.5;
                    visibility: visible;
                    pointer-events: auto;
                    z-index: 1000; /* Ensure this is high enough, but below feedback-container */
                }

                #feedback-container {
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--app-bg);
                    padding: 30px;
                    border-radius: 15px;
                    text-align: center;
                    z-index: 1001;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 20px;
                    max-width: 90%;
                    width: 400px;
                }

                #feedback-container.visible {
                    opacity: 1;
                    visibility: visible;
                }

                #feedback-container.hidden {
                    display: none;
                }

                #feedback-text {
                    font-size: 1.2rem;
                    color: var(--text-color);
                    margin-bottom: 10px;
                    display: block;
                }

                #continue-btn {
                    background: linear-gradient(45deg, #008000, #00a000);
                    color: white;
                    border: none;
                    border-radius: 25px;
                    padding: 12px 30px;
                    font-size: 1.1rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    margin-top: 20px;
                    box-shadow: 0 4px 15px rgba(0, 128, 0, 0.3);
                    display: block;
                    width: auto;
                    min-width: 200px;
                }

                #continue-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(0, 128, 0, 0.4);
                }

                #continue-btn:active {
                    transform: translateY(0);
                    box-shadow: 0 2px 10px rgba(0, 128, 0, 0.2);
                }
            `;
            document.head.appendChild(feedbackStyles);

            const steps = document.querySelectorAll('.step-container');
            const progressIndicator = document.getElementById('progress-indicator');
            const nextButtons = document.querySelectorAll('.nav-btn.next');
            const prevButtons = document.querySelectorAll('.nav-btn.prev');
            const optionItems = document.querySelectorAll('.option-item');
            const quizContainer = document.getElementById('quiz-container');
            const letsgoButtonContainer = document.getElementById('letsgo-button-container');
            const pageTransition = document.getElementById('page-transition');
            const confettiCanvas = document.getElementById('confetti-canvas');
            
            // Variables for quiz functionality
            let currentStep = 0;
            let currentQuestionIndex = 0;
            let correctAnswers = 0;
            let selectedOptions = {
                step1: null,
                step2: null,
                step3: null
            };
            let isProcessingAnswer = false;

            // Initialize confetti
            const confetti = {
                maxCount: 150,     // max particles
                speed: 2,          // particle speed factor
                frameInterval: 15, // render frame rate
                alpha: 1.0,        // particle alpha
                gradient: false,   // color gradient
                start: null        // start function
            };

            // Create a confetti animation
            confetti.start = function() {
                let context = confettiCanvas.getContext("2d");
                let width = window.innerWidth;
                let height = window.innerHeight;
                confettiCanvas.width = width;
                confettiCanvas.height = height;
                
                let particles = [];
                let particle;
                let angle = 0;
                
                // Create particles
                for (let i = 0; i < this.maxCount; i++) {
                    particle = {
                        x: Math.random() * width,
                        y: Math.random() * height - height,
                        r: 4 + Math.random() * 6,
                        d: Math.random() * this.maxCount,
                        color: randomColor(),
                        tilt: Math.floor(Math.random() * 10) - 10,
                        tiltAngleIncrement: Math.random() * 0.07 + 0.05,
                        tiltAngle: 0
                    };
                    particles.push(particle);
                }
                
                // Animation loop
                let animationTimer = null;
                function draw() {
                    if (!animationTimer) return;
                    
                    context.clearRect(0, 0, width, height);
                    
                    for (let i = 0; i < confetti.maxCount; i++) {
                        particle = particles[i];
                        context.beginPath();
                        context.lineWidth = particle.r / 2;
                        context.strokeStyle = particle.color;
                        context.moveTo(particle.x + particle.tilt + particle.r / 4, particle.y);
                        context.lineTo(particle.x + particle.tilt, particle.y + particle.r);
                        context.stroke();
                        
                        particle.tiltAngle += particle.tiltAngleIncrement;
                        particle.y += (Math.cos(angle) + 1 + particle.r / 10) * confetti.speed;
                        particle.tilt = 15 * Math.sin(particle.tiltAngle);
                        
                        // If particle is out of bounds, reset it
                        if (particle.y > height) {
                            if (i % 5 > 0 || i % 2 == 0) {
                                particles[i] = {
                                    x: Math.random() * width,
                                    y: -10,
                                    r: particle.r,
                                    d: particle.d,
                                    color: randomColor(),
                                    tilt: Math.floor(Math.random() * 10) - 10,
                                    tiltAngleIncrement: particle.tiltAngleIncrement,
                                    tiltAngle: particle.tiltAngle
                                };
                            } else {
                                // Fast-forward to a new position
                                particles[i] = {
                                    x: Math.random() * width,
                                    y: -10,
                                    r: particle.r,
                                    d: particle.d,
                                    color: randomColor(),
                                    tilt: Math.floor(Math.random() * 10) - 10,
                                    tiltAngleIncrement: particle.tiltAngleIncrement,
                                    tiltAngle: particle.tiltAngle
                                };
                            }
                        }
                    }
                    angle += 0.01;
                    
                    requestAnimationFrame(draw);
                }
                
                // Generate random color
                function randomColor() {
                    const colors = [
                        "#f44336", "#e91e63", "#9c27b0", "#673ab7", "#3f51b5",
                        "#2196f3", "#03a9f4", "#00bcd4", "#009688", "#4CAF50", 
                        "#8BC34A", "#CDDC39", "#FFEB3B", "#FFC107", "#FF9800", "#FF5722"
                    ];
                    return colors[Math.floor(Math.random() * colors.length)];
                }
                
                // Start animation
                animationTimer = requestAnimationFrame(draw);
                
                // Apply fadeout and stop after 2 seconds (reduced from 4 seconds)
                setTimeout(() => {
                    confettiCanvas.classList.add('confetti-fade-out');
                    setTimeout(() => {
                        cancelAnimationFrame(animationTimer);
                        animationTimer = null;
                        context.clearRect(0, 0, width, height);
                        confettiCanvas.classList.remove('confetti-fade-out');
                    }, 500); // 500ms fadeout
                }, 1500); // 1.5s active animation + 0.5s fadeout = 2s total
            };
            
            // Quiz questions data - Simplified version
            const quizQuestions = [
                {
                    question: "Your friend says he bought a phone on EMI with 0% interest. Is it really free?",
                    options: [
                        "Yes, no interest = free money",
                        "Not always â€” there might be hidden processing fees",
                        "Only if he pays the full amount upfront",
                        "Yes, it's always free if 0% is written"
                    ],
                    correctIndex: 1,
                    explanation: "Zero percent interest offers often hide processing fees, administration charges, or higher product prices to compensate for the 'free' interest."
                },
                {
                    question: "You get a â‚¹10,000 salary. Which of these is the smartest first step?",
                    options: [
                        "Spend first, save what's left",
                        "Buy things on sale to \"save money\"",
                        "Save/invest first, then spend the rest",
                        "Withdraw everything in cash"
                    ],
                    correctIndex: 2,
                    explanation: "Paying yourself first (saving/investing before spending) ensures you build wealth consistently rather than saving only what's left after spending."
                },
                {
                    question: "You missed a credit card payment by 1 day. What's likely to happen?",
                    options: [
                        "Nothing, it's just 1 day",
                        "You'll lose the card forever",
                        "Late fee + interest may be charged",
                        "Credit card company will ignore it"
                    ],
                    correctIndex: 2,
                    explanation: "Even being one day late can result in late payment fees and interest charges on your outstanding balance. Some cards may also apply penalty interest rates."
                },
                {
                    question: "What does \"compounding\" mean in investing?",
                    options: [
                        "Interest only on the initial amount",
                        "Doubling your money every year",
                        "Earning interest on interest over time",
                        "Spending more to earn more rewards"
                    ],
                    correctIndex: 2,
                    explanation: "Compounding is the process where your investment returns (interest, dividends, etc.) are added to your principal, and then earn additional returns themselves, accelerating growth over time."
                },
                {
                    question: "Which of these is a smart reason to start budgeting?",
                    options: [
                        "To track every single rupee you spend",
                        "To feel guilty about spending",
                        "To understand and control your money",
                        "To make life boring and restrictive"
                    ],
                    correctIndex: 2,
                    explanation: "Budgeting gives you awareness and control over your finances, helping you make informed decisions about your money rather than restricting your life or making you feel guilty."
                }
            ];
            
            // Handle entry transition
            setTimeout(() => {
                if (pageTransition.classList.contains('active')) {
                    pageTransition.classList.remove('active');
                }
            }, 200);

            // Show the current step with luxury fade transitions
            function showStep(stepIndex) {
                // Hide Jigu's previous option-specific message when changing steps
                if (uncleMessage && happyUncleContainer.classList.contains('top-left')) {
                    if (uncleMessage.classList.contains('visible')) {
                        uncleMessage.classList.remove('visible');
                        uncleMessage.classList.remove('floating-top-left-message'); // Stop floating when message hides
                        // After transition, set display to none so it doesn't occupy space
                        setTimeout(() => {
                            if (!uncleMessage.classList.contains('visible')) { // Check again in case it was made visible quickly
                                uncleMessage.style.display = 'none';
                            }
                        }, 500); // Matches opacity transition duration (0.5s)
                    }
                }

                // Handle transitions smoothly
                let activeStep = null;
                
                // Find the currently active step
                steps.forEach((step, index) => {
                    if (step.classList.contains('active')) {
                        activeStep = {index, element: step};
                    }
                });
                
                // If there is an active step (not initial load)
                if (activeStep) {
                    // Fade out current step with subtle scale
                    activeStep.element.classList.add('fade-out');
                    
                    // After a short delay, hide current and fade in next
                    setTimeout(() => {
                        activeStep.element.classList.remove('active', 'fade-out');
                        
                        // Start next step invisible
                        steps[stepIndex].style.opacity = '0';
                        steps[stepIndex].style.transform = 'translateY(0) scale(0.98)';
                        steps[stepIndex].classList.add('active');
                        
                        // Force reflow
                        void steps[stepIndex].offsetWidth;
                        
                        // Fade in next step
                        steps[stepIndex].style.opacity = '1';
                        steps[stepIndex].style.transform = 'translateY(0) scale(1)';
                        
                        // Update progress bar with elegant timing
                        progressIndicator.style.width = `${(stepIndex + 1) * 25}%`;
                        progressIndicator.classList.add('progress-fill-animation');
                    }, 500); // Slightly longer delay for luxury pacing
                }
                // Initial load (no animation needed)
                else {
                    steps.forEach((step, index) => {
                        if (index === stepIndex) {
                            step.classList.add('active');
                        } else {
                            step.classList.remove('active');
                        }
                    });
                    
                    // Update progress bar
                    progressIndicator.style.width = `${(stepIndex + 1) * 20}%`; // Adjusted for 5 steps
                }
                
                currentStep = stepIndex;

                // If showing step3_5, populate accomplishments
                if (steps[stepIndex].id === 'step3_5') {
                    populateAccomplishments();
                    // Enable the Next button for step3_5 as it has no user selections
                    const nextButtonStep3_5 = document.querySelector('#step3_5 .nav-btn.next');
                    if (nextButtonStep3_5) {
                        nextButtonStep3_5.removeAttribute('disabled');
                    }
                }

                // Calculate and set the height for the app-container for the incoming step
                const appContainer = document.querySelector('.app-container');
                const progressBarHeight = document.getElementById('progress-bar').offsetHeight;
                const incomingStepElement = steps[stepIndex];
                
                // Temporarily display the incoming step to measure its height
                incomingStepElement.style.visibility = 'hidden'; // Keep it hidden from user
                incomingStepElement.style.display = 'block'; // Needs to be block to measure
                incomingStepElement.style.position = 'absolute'; // Take out of flow to not affect current layout
                const incomingStepHeight = incomingStepElement.scrollHeight;
                incomingStepElement.style.visibility = ''; // Reset visibility
                incomingStepElement.style.display = ''; // Reset display
                incomingStepElement.style.position = ''; // Reset position

                const targetHeight = incomingStepHeight + progressBarHeight + 60; // 60 for padding/margins
                appContainer.style.height = `${targetHeight}px`;

                // After the transition, set height to auto to allow for responsive content
                setTimeout(() => {
                    if (steps[stepIndex].classList.contains('active')) { // Only if this step is still active
                         appContainer.style.height = 'auto';
                    }
                }, 800); // Match the transition duration + a small buffer
            }

            // Feedback message library
            const feedbackMessages = {
                step1: {
                    save_better: [
                        "Smart choice. Saving is the first flex.",
                        "That's a power move. Let's make it easy.",
                        "Brilliant start! Saving creates options.",
                        "Future you is already grateful.",
                        "Money saved = freedom earned."
                    ],
                    stop_wasting: [
                        "We'll turn those leaks into lakes.",
                        "Small changes, big impact. Let's go!",
                        "That money deserves better. You've got this.",
                        "Cutting waste = instant wealth.",
                        "This is how fortunes begin."
                    ],
                    build_habits: [
                        "Early habits = lifelong wealth.",
                        "You're ahead of 90% already.",
                        "Future millionaire move right there.",
                        "Small habits, massive results.",
                        "You'll thank yourself every day."
                    ],
                    smarter_than_parents: [
                        "Each generation levels up. Your turn.",
                        "New generation, new money rules.",
                        "Financial evolution starts with you.",
                        "Parents taught values, you'll master money.",
                        "Breaking the cycle starts here."
                    ],
                    exploring: [
                        "Curiosity creates wealth. Let's explore.",
                        "Best journeys start with exploration.",
                        "Perfect place to start. Let's discover.",
                        "Financial curiosity is step one to mastery.",
                        "Let's turn that curiosity into cash."
                    ]
                },
                step2: {
                    casual: [
                        "Perfect. Small daily wins add up.",
                        "5 minutes daily beats 5 hours monthly.",
                        "Consistency beats intensity. Good choice.",
                        "Bite-sized wisdom creates lasting wealth.",
                        "Small steps, big progress."
                    ],
                    focused: [
                        "The sweet spot of learning. Excellent!",
                        "10 minutes daily = expertise in months.",
                        "You'll be money-smart in no time.",
                        "Focused learning creates lasting results.",
                        "Goldilocks zone: just right for mastery."
                    ],
                    olympian: [
                        "Going for gold! Love the commitment.",
                        "Future financial champion in the making.",
                        "That's how wealth mastery happens.",
                        "Elite mindset leads to elite results.",
                        "Exceptional commitment = exceptional results."
                    ]
                },
                step3: {
                    zero: [
                        "Perfect place to start. Clean slate.",
                        "Starting from zero means no bad habits.",
                        "Beginners often learn faster. You've got this.",
                        "Fresh start, fresh perspective.",
                        "We'll build your foundation brick by brick."
                    ],
                    some_knowledge: [
                        "We'll build on what you know.",
                        "Great! You've got a running start.",
                        "Some knowledge + new skills = financial power.",
                        "We'll fill in the gaps and level you up.",
                        "That's a great foundation to build on."
                    ],
                    quiz: [
                        "Smart move. Let's find your perfect level.",
                        "Custom path coming right up!",
                        "We'll meet you exactly where you are.",
                        "Let's find your ideal starting point.",
                        "Let the journey fit your exact needs."
                    ]
                }
            };

            // Enhanced option selection with feedback
            optionItems.forEach(item => {
                item.addEventListener('click', function() {
                    const parent = this.parentElement;
                    const stepId = this.closest('.step-container').id;
                    const optionValue = this.dataset.value;
                    
                    // Remove selected class from all options in this step
                    parent.querySelectorAll('.option-item').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option with animation
                    this.classList.add('selected');
                    this.style.animation = 'pulse 0.3s forwards';
                    
                    // Reset animation after it completes
                    setTimeout(() => {
                        this.style.animation = '';
                    }, 300);
                    
                    // Store selection
                    selectedOptions[stepId] = optionValue;
                    
                    // Enable next button for this step
                    document.querySelector(`#${stepId} .nav-btn.next`).removeAttribute('disabled');
                    
                    // Hide old feedback message container
                    const oldFeedbackContainer = document.getElementById(`${stepId}-feedback`);
                    if (oldFeedbackContainer) {
                        oldFeedbackContainer.classList.remove('active');
                        oldFeedbackContainer.style.display = 'none'; // Remove from layout
                    }
                    
                    // Show feedback message via Jigu's speech bubble
                    if (feedbackMessages[stepId] && feedbackMessages[stepId][optionValue]) {
                        const messages = feedbackMessages[stepId][optionValue];
                        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                        
                        if (uncleMessage && happyUncleContainer.classList.contains('top-left')) {
                            uncleMessage.textContent = randomMessage;
                            uncleMessage.style.display = ''; // Reset display if it was 'none'
                            
                            // Force reflow to ensure opacity transition plays
                            void uncleMessage.offsetWidth; 
                            
                            uncleMessage.classList.add('visible');
                            // If Jigu is floating in the top-left, make the message float too
                            if (happyUncleImage.classList.contains('floating-top-left')) {
                                uncleMessage.classList.add('floating-top-left-message');
                            }
                            
                            // Ensure the main happy-uncle-container is also visible
                            happyUncleContainer.classList.add('visible');
                        }
                    }
                });
            });

            // Next button functionality
            nextButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const currentStepElement = this.closest('.step-container');
                    let nextStepNodeListIndex = -1;

                    if (currentStepElement.id === 'step1') {
                        nextStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step2');
                    } else if (currentStepElement.id === 'step2') {
                        nextStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step3');
                    } else if (currentStepElement.id === 'step3') {
                        nextStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step3_5');
                         // Special handling for step 3 if quiz is selected for redirection later
                        if (selectedOptions.step3 === 'quiz') {
                            // Logic for quiz redirection is handled when gold button is clicked in step4
                        }
                    } else if (currentStepElement.id === 'step3_5') {
                        nextStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step4');
                    }

                    if (nextStepNodeListIndex === -1) {
                        console.error("Could not determine next step for button:", this.id, "in step:", currentStepElement.id);
                        return;
                    }
                    
                    showStep(nextStepNodeListIndex);
                    
                    // Special handling for when step 4 becomes active
                    if (steps[nextStepNodeListIndex] && steps[nextStepNodeListIndex].id === 'step4') {
                        const goldButton = document.createElement('button');
                        goldButton.className = 'gold-button';
                        goldButton.textContent = 'Let\'s Go';
                        goldButton.addEventListener('click', startQuiz);
                        letsgoButtonContainer.innerHTML = ''; 
                        letsgoButtonContainer.appendChild(goldButton);
                        
                        goldButton.style.display = 'block';
                        setTimeout(() => {
                            goldButton.style.opacity = '1';
                            goldButton.style.animation = 'pulse 1.5s infinite';
                        }, 50);
                    }
                });
            });

            // Previous button functionality
            prevButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const currentStepElement = this.closest('.step-container');
                    let prevStepNodeListIndex = -1;

                    if (quizContainer.style.display === 'block') {
                        quizContainer.style.display = 'none';
                        prevStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step3_5');
                        if (prevStepNodeListIndex !== -1) {
                            showStep(prevStepNodeListIndex);
                        } else {
                            console.error("Could not determine previous step from quiz to step3_5");
                        }
                        return; 
                    }

                    if (currentStepElement.id === 'step2') {
                        prevStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step1');
                    } else if (currentStepElement.id === 'step3') {
                        prevStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step2');
                    } else if (currentStepElement.id === 'step3_5') {
                        prevStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step3');
                    } else if (currentStepElement.id === 'step4') {
                        prevStepNodeListIndex = Array.from(steps).findIndex(s => s.id === 'step3_5');
                    }

                    if (prevStepNodeListIndex === -1 && currentStepElement.id !== 'step1') { // step1 has no prev
                        console.error("Could not determine previous step for button in step:", currentStepElement.id);
                        return;
                    }
                    
                    if (prevStepNodeListIndex !== -1) {
                         showStep(prevStepNodeListIndex);
                    }
                });
            });

            // Function to generate dynamic accomplishments
            function generateAccomplishments(options) {
                const accomplishments = [];
                const emojis = ['ðŸŽ¯', 'ðŸ“ˆ', 'ðŸ’¡', 'ðŸš€', 'ðŸ’°', 'ðŸ§ ', 'ðŸŒŸ', 'ðŸ†', 'ðŸ”‘'];
                let emojiIndex = 0;

                const getRandomEmoji = () => {
                    const emoji = emojis[emojiIndex % emojis.length];
                    emojiIndex++;
                    return emoji;
                };

                // Step 1: Why are you here?
                switch (options.step1) {
                    case 'save_better':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Develop consistent saving habits that stick.' });
                        break;
                    case 'stop_wasting':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Identify and eliminate unnecessary spending.' });
                        break;
                    case 'smarter_than_parents':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Gain modern financial knowledge to surpass previous generations.' });
                        break;
                    case 'exploring':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Discover key financial concepts at your own pace.' });
                        break;
                    default:
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Build a strong foundation in personal finance.' });
                }

                // Step 2: How much time can you give it?
                switch (options.step2) {
                    case 'casual':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Learn valuable money skills in just a few minutes a day.' });
                        break;
                    case 'focused':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Make significant progress with focused daily learning.' });
                        break;
                    case 'olympian':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Achieve financial mastery with dedicated effort.' });
                        break;
                    default:
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Efficiently absorb financial wisdom tailored to your schedule.' });
                }

                // Step 3: Pick your starting point
                switch (options.step3) {
                    case 'zero':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Go from knowing nothing to confidently managing your money.' });
                        break;
                    case 'some_knowledge':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Expand your existing knowledge and fill any gaps.' });
                        break;
                    case 'quiz':
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Pinpoint your current level and accelerate your learning.' });
                        break;
                    default:
                        accomplishments.push({ emoji: getRandomEmoji(), text: 'Embark on a personalized learning journey.' });
                }
                
                // Ensure there are always 3 unique bullet points, even if some default cases were hit
                const allPossibleAccomplishments = [
                    { emoji: 'ðŸŽ¯', text: 'Set and achieve clear financial goals.' },
                    { emoji: 'ðŸ“ˆ', text: 'Understand how to grow your money effectively.' },
                    { emoji: 'ðŸ’¡', text: 'Make smarter financial decisions every day.' },
                    { emoji: 'ðŸš€', text: 'Fast-track your journey to financial independence.' },
                    { emoji: 'ðŸ’°', text: 'Take control of your financial future.' },
                    { emoji: 'ðŸ§ ', text: 'Develop a strong financial mindset.' },
                    { emoji: 'ðŸŒŸ', text: 'Unlock new opportunities through financial literacy.' },
                    { emoji: 'ðŸ†', text: 'Become a champion of your own finances.' },
                    { emoji: 'ðŸ”‘', text: 'Discover the keys to building long-term wealth.' }
                ];

                // Add more generic accomplishments if fewer than 3 were generated
                let currentAccomplishmentsTexts = accomplishments.map(a => a.text);
                while (accomplishments.length < 3) {
                    const potentialAccomplishment = allPossibleAccomplishments[Math.floor(Math.random() * allPossibleAccomplishments.length)];
                    if (!currentAccomplishmentsTexts.includes(potentialAccomplishment.text)) {
                        accomplishments.push({ emoji: getRandomEmoji(), text: potentialAccomplishment.text });
                        currentAccomplishmentsTexts.push(potentialAccomplishment.text);
                    }
                }

                return accomplishments.slice(0, 3); // Return exactly 3 accomplishments
            }

            // Function to populate accomplishments in the list
            function populateAccomplishments() {
                const accomplishmentList = document.getElementById('accomplishmentList');
                const items = generateAccomplishments(selectedOptions);
                accomplishmentList.innerHTML = ''; // Clear existing items

                items.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<span class="emoji-bullet">${item.emoji}</span><span>${item.text}</span>`;
                    accomplishmentList.appendChild(listItem);
                });
            }

            // Load a quiz question with animation
            function loadQuestion(index) {
                const questionDisplayArea = document.getElementById('current-question-display');
                const questionData = quizQuestions[index];

                // 1. Update content immediately
                document.getElementById('question-text').textContent = questionData.question;
                document.getElementById('quiz-progress-text').textContent = `Question ${index + 1}/${quizQuestions.length}`;
                const progressPercent = ((index + 1) / quizQuestions.length) * 100;
                document.getElementById('quiz-page-progress-bar-indicator').style.width = `${progressPercent}%`;

                const optionsContainer = document.getElementById('options-container');
                optionsContainer.innerHTML = ''; // Clear previous options

                questionData.options.forEach((option, optIndex) => {
                    const optionButton = document.createElement('button');
                    optionButton.className = 'option-btn';
                    optionButton.textContent = option;
                    optionButton.addEventListener('click', () => {
                        handleAnswer(optIndex, questionData.correctIndex, questionData.explanation);
                    });
                    optionsContainer.appendChild(optionButton);

                    // Set initial state for individual button animation (they fade/slide in with the question)
                    optionButton.style.opacity = '0';
                    optionButton.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        optionButton.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)'; // Ensure transition is defined here
                        optionButton.style.opacity = '1';
                        optionButton.style.transform = 'translateY(0)';
                    }, 50 + (optIndex * 50)); // Staggered appearance
                });

                // 2. Animate the questionDisplayArea IN
                // Remove potentially lingering animation classes from previous question
                questionDisplayArea.classList.remove('slide-out-left', 'slide-in-right');
                
                // Force a reflow to ensure the class removal is processed and animation can restart cleanly
                void questionDisplayArea.offsetWidth; 

                // Add class to slide in the new question
                questionDisplayArea.classList.add('slide-in-right');
            }
            
            // Handle quiz answer selection - index.html style
            function handleAnswer(selectedIndex, correctIndex, explanation) {
                console.log("handleAnswer called for", selectedIndex, correctIndex);
                
                if (isProcessingAnswer) return;
                isProcessingAnswer = true;
                
                const optionsContainer = document.getElementById('options-container');
                const selectedButton = optionsContainer.children[selectedIndex];
                const correctButton = optionsContainer.children[correctIndex];
                
                // Check if answer is correct
                const isCorrect = selectedIndex === correctIndex;
                console.log("Is answer correct?", isCorrect);
                
                // Play the appropriate sound based on whether the answer is correct or incorrect
                if (isCorrect) {
                    // Play correct sound
                    const correctSound = new Audio('assets/sounds/correct.mp3');
                    correctSound.play();
                    console.log("Played correct.mp3 sound effect");
                    
                    // Play confetti for correct answer
                    confetti.start();
                    
                    selectedButton.classList.add('correct');
                    correctAnswers++;
                } else {
                    // Play incorrect sound
                    const incorrectSound = new Audio('assets/sounds/incorrect.mp3');
                    incorrectSound.play();
                    console.log("Played incorrect.mp3 sound effect");
                    
                    selectedButton.classList.add('incorrect');
                    correctButton.classList.add('correct');
                }
                
                // Disable all option buttons
                Array.from(optionsContainer.children).forEach(button => {
                    button.disabled = true;
                });
                
                // Get direct references
                const feedbackText = document.getElementById('feedback-text');
                const overlay = document.getElementById('overlay');
                const feedbackContainer = document.getElementById('feedback-container');
                
                console.log("Feedback elements:", 
                    { feedbackText: !!feedbackText, overlay: !!overlay, feedbackContainer: !!feedbackContainer });
                
                // Set feedback text normally
                feedbackText.innerHTML = isCorrect ? 
                    `<strong>Correct!</strong><br><br>${explanation}` : 
                    `<strong>Incorrect</strong><br><br>${explanation}`;
                
                // Manage visibility for continue button and feedback container
                const continueBtn = document.getElementById('continue-btn');
                // Clear any potentially conflicting inline styles first
                continueBtn.style.opacity = ''; 
                continueBtn.style.visibility = '';
                continueBtn.style.display = ''; // Let CSS handle display type (block/flex)

                feedbackContainer.style.opacity = '';
                feedbackContainer.style.visibility = '';
                feedbackContainer.style.display = ''; // Let CSS handle display type (flex)
                
                console.log("Setting up to show feedback in 800ms");
                
                // Show overlay and feedback
                setTimeout(() => {
                    console.log("Showing feedback now");
                    overlay.classList.add('active');
                    feedbackContainer.classList.remove('hidden');
                    feedbackContainer.classList.add('visible');
                    
                    // Explicitly ensure continue button is visible using classes if defined, or rely on feedbackContainer being visible
                    // The existing CSS for #feedback-container.visible should make #continue-btn display appropriately.
                }, 800);
            }
            
            // Continue to next question with enhanced transitions
            document.getElementById('continue-btn').addEventListener('click', function() {
                const overlay = document.getElementById('overlay');
                const feedbackContainer = document.getElementById('feedback-container');
                const questionDisplayArea = document.getElementById('current-question-display'); // Changed from questionContainer
                
                // Hide feedback
                overlay.classList.remove('active');
                feedbackContainer.classList.remove('visible');
                feedbackContainer.classList.add('hidden');
                
                // Add animation to current question display area
                questionDisplayArea.classList.remove('slide-in-right'); // Ensure this is removed before adding slide-out
                questionDisplayArea.classList.add('slide-out-left');
                
                setTimeout(() => {
                    isProcessingAnswer = false;
                    
                    // Move to next question or finish quiz
                    currentQuestionIndex++;
                    if (currentQuestionIndex < quizQuestions.length) {
                        loadQuestion(currentQuestionIndex);
                    } else {
                        finishQuiz();
                    }
                }, 300); // Match slide-out animation duration
            });
            
            // Start the quiz with transition
            function startQuiz() {
                const happyUncleContainer = document.querySelector('.happy-uncle-container');
                const uncleMessage = document.querySelector('.uncle-message');
                const uncleContinueBtn = document.querySelector('.uncle-continue-btn');
                const happyUncleImage = document.querySelector('.happy-uncle-image');
                const currentStep4 = document.getElementById('step4');
                const appContainer = document.querySelector('.app-container'); // Get app-container

                // 0. Hide app-container and its contents (Step 4, other steps)
                if (appContainer) {
                    appContainer.style.transition = 'opacity 0.3s ease';
                    appContainer.style.opacity = '0';
                    setTimeout(() => {
                        if (appContainer.style.opacity === '0') appContainer.style.visibility = 'hidden';
                    }, 300); // Match opacity transition
                }
                // currentStep4 and other steps are inside appContainer, so they will be hidden with it.
                // However, explicitly remove 'active' and set display to 'none' for them as well to be safe.
                if (currentStep4) {
                    currentStep4.classList.remove('active');
                    currentStep4.style.display = 'none';
                }
                steps.forEach(s => { 
                    if (s.id !== 'step4') { 
                        s.classList.remove('active');
                        s.style.display = 'none';
                    }
                });
                
                let delayForReposition = 0;

                if (happyUncleContainer.classList.contains('top-left')) {
                    happyUncleImage.classList.remove('floating-top-left');
                    if (uncleMessage.classList.contains('floating-top-left-message')) {
                        uncleMessage.classList.remove('floating-top-left-message');
                    }
                    if (uncleMessage.classList.contains('visible')) {
                        uncleMessage.classList.remove('visible');
                        setTimeout(() => {
                            if (!uncleMessage.classList.contains('visible')) uncleMessage.style.display = 'none';
                        }, 500); 
                    }
                    happyUncleContainer.classList.remove('slide-in');

                    happyUncleContainer.style.transition = 'top 0.8s ease-in-out, left 0.8s ease-in-out, transform 0.8s ease-in-out';
                    happyUncleImage.style.transition = 'transform 0.8s ease-in-out';

                    happyUncleContainer.style.top = '50%';
                    happyUncleContainer.style.left = '50%';
                    happyUncleContainer.style.transform = 'translate(-50%, -50%)';
                    happyUncleImage.style.transform = 'scaleX(-1)'; 

                    delayForReposition = 800; 

                    setTimeout(() => { 
                        happyUncleContainer.classList.remove('top-left');
                    }, 50);

                } else {
                    happyUncleContainer.style.top = '50%';
                    happyUncleContainer.style.left = '50%';
                    happyUncleContainer.style.transform = 'translate(-50%, -50%)';
                    happyUncleImage.style.transform = 'scaleX(-1)';
                    happyUncleContainer.classList.add('visible'); 
                }

                setTimeout(() => {
                    happyUncleContainer.style.transition = '';
                    happyUncleImage.style.transition = '';

                    uncleMessage.textContent = "Well, I'll be leaving now, you can always find me on the main menu, see you";
                    uncleMessage.style.display = ''; 
                    uncleMessage.classList.add('visible');

                    uncleContinueBtn.style.display = ''; 
                    uncleContinueBtn.classList.add('visible');

                    happyUncleContainer.classList.add('floating');

                    uncleContinueBtn.onclick = () => {
                        if(pageTransition) pageTransition.classList.add('active');

                        happyUncleContainer.classList.remove('floating');
                        uncleMessage.classList.remove('visible');
                        uncleContinueBtn.classList.remove('visible');

                        setTimeout(() => {
                            uncleMessage.style.display = 'none';
                            uncleContinueBtn.style.display = 'none';

                            happyUncleContainer.classList.add('flipped');

                            setTimeout(() => {
                                happyUncleContainer.classList.add('slide-out');

                                happyUncleContainer.addEventListener('animationend', function handleJiguFarewellSlideOut(event) {
                                    if (event.animationName === 'slideOut' && event.target === happyUncleContainer) {
                                        happyUncleContainer.removeEventListener('animationend', handleJiguFarewellSlideOut);
                                        happyUncleContainer.classList.remove('visible', 'slide-out', 'flipped');
                                        happyUncleImage.style.transform = ''; 
                                        happyUncleContainer.style.display = 'none'; // Explicitly hide Jigu

                                        // Deactivate page transition overlay EARLIER, before loading questions
                                        if(pageTransition) pageTransition.classList.remove('active');

                                        setTimeout(() => {
                                            // Make app-container visible again (behind the pageTransition)
                                            if (appContainer) {
                                                appContainer.style.visibility = 'visible';
                                                appContainer.style.opacity = '1'; // It will be revealed when pageTransition fades
                                                appContainer.classList.add('quiz-active'); // Add class for height adjustment
                                            }
                                            steps.forEach(s => { s.style.display = 'none'; s.classList.remove('active');});
                                            if (currentStep4) currentStep4.style.display = 'none';

                                            quizContainer.style.display = 'block';
                                            quizContainer.classList.add('active-quiz-layout'); // Activate new layout styles
                                            quizContainer.style.opacity = '0';
                                            quizContainer.style.transform = 'translateY(20px)';

                                            // The main progress bar (#progress-bar) is now hidden by CSS
                                            // The old progress-indicator inside #progress-bar is no longer updated here.
                                            // The new quiz-page-progress-bar-indicator will be handled by loadQuestion.

                                            // Removed mobile-quiz class logic as new CSS handles responsiveness
                                            // if (document.documentElement.getAttribute('data-device') === 'mobile') {
                                            //     document.querySelector('.quiz-container').classList.add('mobile-quiz');
                                            //     if (document.getElementById('options-container')) {
                                            //         document.getElementById('options-container').style.gridTemplateColumns = '1fr';
                                            //     }
                                            // }

                                            currentQuestionIndex = 0; 
                                            correctAnswers = 0;
                                            loadQuestion(currentQuestionIndex); 

                                            setTimeout(() => {
                                                // if(pageTransition) pageTransition.classList.remove('active'); // Moved earlier
                                                quizContainer.style.opacity = '1';
                                                quizContainer.style.transform = 'translateY(0)';
                                            }, 50); // This delay is for quizContainer fade-in
                                        }, 500); // Delay after Jigu slides out before showing quiz content
                                    }
                                });
                            }, 300);
                        }, 500); 
                    };
                }, delayForReposition);
            }

            // Finish the quiz and redirect
            function finishQuiz() {
                // Store user selections in localStorage for potential use in signup
                localStorage.setItem('userPreferences', JSON.stringify(selectedOptions));
                localStorage.setItem('quizScore', correctAnswers);
                localStorage.setItem('quizTotal', quizQuestions.length);
                
                // Special animation for completion
                if (correctAnswers >= 4) { // If they got at least 4 correct, show a big confetti celebration
                    confetti.start();
                }
                
                // Create dark overlay
                const darkOverlay = document.createElement('div');
                darkOverlay.className = 'dark-overlay';
                document.body.appendChild(darkOverlay);
                
                // Create and show iPhone container
                const iphoneContainer = document.createElement('div');
                iphoneContainer.className = 'iphone-container';
                iphoneContainer.innerHTML = `
                    <img src="assets/images/iphone.png" alt="iPhone" class="iphone-image">
                    <button id="continue-to-signup" class="continue-btn">Take me there!</button>
                `;
                document.body.appendChild(iphoneContainer);
                
                // Force reflow to ensure the transition works
                void iphoneContainer.offsetWidth;
                void darkOverlay.offsetWidth;
                
                // Trigger animations
                setTimeout(() => {
                    darkOverlay.classList.add('active');
                    iphoneContainer.classList.add('active');
                    
                    // Add hovering animation after reaching center
                    setTimeout(() => {
                        iphoneContainer.classList.add('hovering');
                        
                        // Show continue button after animation completes
                        const continueBtn = document.getElementById('continue-to-signup');
                        continueBtn.style.display = 'block';
                        
                        // Force reflow
                        void continueBtn.offsetWidth;
                        
                        continueBtn.classList.add('visible');
                    }, 1000); // Wait for iPhone to reach center
                }, 100);
                
                // Add event listener to the continue button
                setTimeout(() => {
                    document.getElementById('continue-to-signup').addEventListener('click', function() {
                        window.location.href = 'signup.html';
                    });
                }, 1200); // Add event listener after button appears
            }

            // Initialize first step
            showStep(0);
            
            // Adjust for window resizing
            window.addEventListener('resize', function() {
                if (confettiCanvas) {
                    confettiCanvas.width = window.innerWidth;
                    confettiCanvas.height = window.innerHeight;
                }
            });

            // Add validation to ensure options are selected
            function validateStepSelection() {
                // Make sure all next buttons are disabled initially
                document.querySelectorAll('.nav-btn.next').forEach(btn => {
                    btn.disabled = true;
                });

                // Setup validation for each step
                const steps = ['step1', 'step2', 'step3'];
                steps.forEach(stepId => {
                    // Check if this step has a selected option on page load
                    const selectedOption = selectedOptions[stepId];
                    if (selectedOption) {
                        // If there's a selection, enable the next button
                        const nextBtn = document.querySelector(`#${stepId} .nav-btn.next`);
                        if (nextBtn) nextBtn.disabled = false;
                        
                        // Also visually select the option
                        const optionElement = document.querySelector(`#${stepId} .option-item[data-value="${selectedOption}"]`);
                        if (optionElement) optionElement.classList.add('selected');
                    }
                });
            }

            // Initialize validation after everything else is setup
            setTimeout(validateStepSelection, 100);
            
            // Add a test to make sure tooltips work on sample content
            setTimeout(() => {
                // Create a test element with financial terms to confirm tooltips are working
                const testContainer = document.createElement('div');
                testContainer.style.display = 'none';
                testContainer.innerHTML = '<p>Test text with financial terms like compound interest and budget.</p>';
                document.body.appendChild(testContainer);
                
                // Apply highlighting to the test container
                testContainer.innerHTML = highlightFinancialTerms(testContainer.innerHTML);
                
                // Initialize tooltips
                initializeFinancialTerms();
                
                // Cleanup test element
                document.body.removeChild(testContainer);
                
                console.log("Financial term tooltips initialized successfully!");
            }, 1000);
        });
    </script>
    <script src="js/navigation.js"></script>
</body>
</html> 
